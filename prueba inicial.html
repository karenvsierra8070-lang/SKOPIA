<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn칩stico Inicial - Sk칩pia</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --color-crema: #fdfbf5;
            --color-oliva-claro: #bec092;
            --color-oliva-oscuro: #272b00;
            --color-oliva-medio: #5a6133;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--color-crema);
            color: var(--color-oliva-oscuro);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .welcome-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .welcome-modal {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-top: 5px solid var(--color-oliva-oscuro);
        }

        .welcome-modal h2 {
            font-family: 'Patrick Hand', cursive;
            font-size: 2rem;
            color: var(--color-oliva-oscuro);
            margin-bottom: 20px;
        }

        .welcome-modal p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .start-button {
            background-color: var(--color-oliva-oscuro);
            color: var(--color-crema);
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .start-button:hover {
            background-color: var(--color-oliva-medio);
            transform: scale(1.05);
        }

        .quiz-container {
            width: 90%;
            max-width: 800px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            padding: 0;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background-color: var(--color-oliva-oscuro);
            transition: width 0.5s ease;
        }

        .question-area {
            display: flex;
            padding: 40px;
            gap: 30px;
            align-items: flex-start;
        }

        .panda-container {
            flex-shrink: 0;
        }

        .panda-avatar {
            font-size: 6rem;
            animation: panda-greet 4s ease-in-out infinite;
        }

        @keyframes panda-greet {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-10deg) scale(1.05); }
            50% { transform: rotate(0deg) scale(1); }
            75% { transform: rotate(10deg) scale(1.05); }
        }

        .speech-bubble {
            position: relative;
            background: #ffffff;
            border: 2px solid var(--color-oliva-claro);
            border-radius: 15px;
            padding: 20px 25px;
            flex-grow: 1;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 15px 15px 15px 0;
            border-style: solid;
            border-color: transparent var(--color-oliva-claro) transparent transparent;
        }

        .question-text {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.4rem;
            color: var(--color-oliva-oscuro);
            margin: 0;
        }
        
        .question-text img {
            max-width: 100%;
            margin-top: 15px;
            border-radius: 10px;
        }

        .options-container {
            padding: 0 40px 40px 40px;
        }

        .option-label {
            display: block;
            background-color: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            padding-left: 50px;
        }

        .option-label:hover {
            background-color: var(--color-oliva-claro);
            border-color: var(--color-oliva-medio);
            transform: translateX(5px);
        }

        .option-label input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .checkmark {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            height: 20px;
            width: 20px;
            background-color: #eee;
            border: 2px solid #ccc;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .option-label:hover input ~ .checkmark {
            background-color: #ccc;
        }

        .option-label input:checked ~ .checkmark {
            background-color: var(--color-oliva-oscuro);
            border-color: var(--color-oliva-oscuro);
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        .option-label input:checked ~ .checkmark:after {
            display: block;
        }

        .submit-container {
            text-align: center;
            padding: 20px;
            background-color: #f7f7f7;
        }

        .submit-button {
            background-color: var(--color-oliva-oscuro);
            color: var(--color-crema);
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-button:hover {
            background-color: var(--color-oliva-medio);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <div id="welcome-overlay" class="welcome-overlay">
        <div class="welcome-modal">
            <h2>춰No tan r치pido!</h2>
            <p>Como es tu primera vez en esta p치gina, te invitamos a realizar un cuestionario de prueba para saber tus competencias en el Saber Pro. Pero no te preocupes, tu resultado no interferir치 en las notas ni en tus objetivos, solo es para saber tu nivel inicial.</p>
            <button id="start-quiz-btn" class="start-button">Comenzar Cuestionario</button>
        </div>
    </div>

    <main id="quiz-container" class="quiz-container">
        <div class="progress-bar-container">
            <div id="progress-fill" class="progress-bar-fill"></div>
        </div>

        <div class="question-area">
            <div class="panda-container">
                <div class="panda-avatar">游냪</div>
            </div>
            <div class="speech-bubble">
                <p id="question-text" class="question-text">Cargando pregunta...</p>
            </div>
        </div>

        <div id="options-container" class="options-container"></div>

        <div class="submit-container">
            <button id="submit-btn" class="submit-button">Enviar Respuestas</button>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const welcomeOverlay = document.getElementById('welcome-overlay');
            const quizContainer = document.getElementById('quiz-container');
            const startQuizBtn = document.getElementById('start-quiz-btn');

            let questions = [];
            let currentQuestionIndex = 0;
            let userAnswers = [];

            welcomeOverlay.classList.remove('hidden');

            startQuizBtn.addEventListener('click', () => {
                welcomeOverlay.classList.add('hidden');
                quizContainer.style.display = 'flex';
                loadQuestions();
            });

            async function loadQuestions() {
                try {
                    // Esta ruta funciona perfectamente en GitHub Pages
                    const response = await fetch('data/preguntas.json');
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}. No se pudo cargar el archivo de preguntas.`);
                    }
                    const data = await response.json();

                    if (!Array.isArray(data)) {
                        throw new Error("El archivo JSON no tiene el formato de array esperado.");
                    }
                    
                    questions = data.filter(q => q.tags && q.tags.includes('diagnostico'));
                    
                    if (questions.length === 0) {
                        throw new Error("No se encontraron preguntas con el tag 'diagnostico'.");
                    }

                    questions = shuffleArray(questions).slice(0, 10);
                    displayQuestion();
                } catch (error) {
                    console.error("Error al cargar las preguntas:", error);
                    alert("Error al cargar las preguntas: " + error.message);
                }
            }

            function displayQuestion() {
                if (currentQuestionIndex >= questions.length) {
                    finishQuiz();
                    return;
                }

                const question = questions[currentQuestionIndex];
                const questionTextEl = document.getElementById('question-text');
                const optionsContainer = document.getElementById('options-container');

                questionTextEl.innerHTML = '';
                optionsContainer.innerHTML = '';

                const questionTextSpan = document.createElement('span');
                questionTextSpan.innerText = question.pregunta;
                questionTextEl.appendChild(questionTextSpan);

                if (question.imagen) {
                    const img = document.createElement('img');
                    img.src = question.imagen;
                    img.alt = "Imagen de la pregunta";
                    questionTextEl.appendChild(img);
                }
                
                question.opciones.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'option-label';
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = 'answer';
                    input.value = index;
                    const checkmark = document.createElement('span');
                    checkmark.className = 'checkmark';
                    label.appendChild(input);
                    label.appendChild(checkmark);
                    label.appendChild(document.createTextNode(option));
                    optionsContainer.appendChild(label);
                });
                updateProgress();
            }

            document.getElementById('submit-btn').addEventListener('click', () => {
                const selected = document.querySelector('input[name="answer"]:checked');
                if (!selected) return alert("Por favor, selecciona una respuesta.");
                userAnswers[currentQuestionIndex] = parseInt(selected.value);
                currentQuestionIndex++;
                displayQuestion();
            });

            function finishQuiz() {
                const correct = userAnswers.filter((a, i) => a === questions[i].respuestaCorrecta).length;
                const result = {
                    type: 'diagnostico',
                    score: correct * 30,
                    correctAnswers: correct,
                    total: questions.length
                };
                localStorage.setItem('resultadoDiagnostico', JSON.stringify(result));

                let resumen = `Cuestionario completado. Tuviste ${correct} respuestas correctas de ${questions.length}.\n\n`;
                resumen += "--- Repaso de Preguntas Incorrectas ---\n";

                questions.forEach((question, index) => {
                    if (userAnswers[index] !== question.respuestaCorrecta) {
                        resumen += `\nPregunta ID: ${question.id}\n`;
                        resumen += `Tu respuesta: ${question.opciones[userAnswers[index]]}\n`;
                        resumen += `Respuesta correcta: ${question.opciones[question.respuestaCorrecta]}\n`;
                        resumen += `Explicaci칩n: ${question.explicacion}\n`;
                        resumen += `游눠 Truco: ${question.truco}\n`;
                    }
                });
                
                alert(resumen);

                window.location.href = "html\resultados.html";
            }

            function updateProgress() {
                const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
                document.getElementById('progress-fill').style.width = progress + '%';
            }

            function shuffleArray(array) {
                let i = array.length, j, temp;
                while (i--) {
                    j = Math.floor(Math.random() * (i + 1));
                    temp = array[i];
                    array[i] = array[j];
                    array[j] = temp;
                }
                return array;
            }
        });
    </script>
</body>
</html>