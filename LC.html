<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Ruta de Lectura Cr√≠tica - Sk√≥pia</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Roboto:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBGEwwuGLP0ULmsJkAhwwmNSlWAotGu_wY",
            projectId: "skopia-aa786",
            storageBucket: "skopia-aa786.firebasestorage.app",
            messagingSenderId: "719823055099",
            appId: "1:719823055099:web:7d91ea29e4b2dcbb9b685e"
        };

        if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
            firebaseConfig.authDomain = "localhost";
        } else {
            firebaseConfig.authDomain = "skopia-aa786.firebaseapp.com";
        }

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'index.html';
                return;
            }
            initializePage(user);
        });

        function initializePage(user) {
            const logoutBtn = document.getElementById('logout-btn');
            logoutBtn.addEventListener('click', () => {
                signOut(auth).then(() => window.location.href = 'index.html');
            });
        }
    </script>

    <style>
        :root {
            --color-crema: #fdfbf5;
            --color-oliva-claro: #bec092;
            --color-oliva-medio: #5a6133;
            --color-oliva-oscuro: #272b00;
            --color-sombra: rgba(39, 43, 0, 0.1);

            /* color for floating icons matched to start-route btn */
            --float-color: var(--color-oliva-oscuro);
            --float-color-hover: var(--color-oliva-medio);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--color-crema) 0%, #f5efe5 100%);
            color: var(--color-oliva-oscuro);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* --- NAVBAR --- */
        .navbar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 15px 40px;
            background-color: white;
            box-shadow: 0 2px 10px var(--color-sombra);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        .hamburger {
            width: 30px;
            height: 25px;
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .hamburger span {
            display: block;
            height: 4px;
            width: 100%;
            background-color: var(--color-oliva-oscuro);
            border-radius: 2px;
            transition: all 0.3s ease-in-out;
        }
        .user-dropdown {
            position: absolute;
            top: 70px;
            right: 40px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px var(--color-sombra);
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.3s, transform 0.3s, visibility 0.3s;
            z-index: 1000;
        }
        .user-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .user-dropdown a {
            display: block;
            padding: 15px 25px;
            text-decoration: none;
            color: var(--color-oliva-oscuro);
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .user-dropdown a:hover {
            background-color: var(--color-crema);
        }
        .user-dropdown hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 0;
        }

        /* --- HERO --- */
        .hero-section {
            text-align: center;
            padding: 100px 20px 40px;
        }
        .logo-centro {
            display: block;
            margin: 0 auto 20px auto;
            height: 120px;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .bienvenida {
            font-family: 'Patrick Hand', cursive;
            font-size: 2.2rem;
            color: var(--color-oliva-oscuro);
            margin-top: 25px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px 40px 40px;
            position: relative;
            min-height: 2000px;
        }

        /* --- RUTA CURVA SVG --- */
        .path-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            height: 100%;
            margin: 0 auto;
        }

        .curved-path-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .path-section {
            position: absolute;
            z-index: 2;
        }

        .topic-node {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px var(--color-sombra);
            position: relative;
            z-index: 10;
            background-color: var(--color-oliva-medio);
        }

        .topic-node:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .topic-node.locked {
            background-color: #7f8c8d !important;
            cursor: not-allowed;
        }

        .topic-node.locked::after {
            content: "\f023";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            font-size: 24px;
            color: #fff;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .subtopic-node {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Patrick Hand', cursive;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px var(--color-sombra);
            position: relative;
            z-index: 10;
            background-color: var(--color-oliva-claro);
        }

        .subtopic-node:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .subtopic-node.locked {
            background-color: #95a5a6 !important;
            cursor: not-allowed;
        }

        .subtopic-node.locked::after {
            content: "\f023";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            font-size: 16px;
            color: #fff;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .node-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-family: 'Patrick Hand', cursive;
            font-size: 0.8rem;
            color: var(--color-oliva-oscuro);
            text-align: center;
            width: 120px;
            z-index: 5;
            background: rgba(253, 251, 245, 0.9);
            padding: 2px 5px;
            border-radius: 5px;
        }

        .subtopic-label {
            width: 80px;
            font-size: 0.7rem;
            bottom: -25px;
        }

        /* --- EXAMEN NODE --- */
        .exam-node {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-oliva-medio), var(--color-oliva-oscuro));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px var(--color-sombra);
            position: relative;
            z-index: 10;
        }

        .exam-node:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .exam-node.locked {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6) !important;
            cursor: not-allowed;
        }

        .exam-node.locked::after {
            content: "\f023";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            font-size: 30px;
            color: #fff;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .exam-node p {
            margin: 5px 0;
            font-size: 0.8rem;
        }

        /* --- FLOATING ICONS & PANELS --- */
        .floating-icons {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 2000;
        }
        .floating-icons button {
            background: var(--float-color);
            color: white;
            width: 54px;
            height: 54px;
            border-radius: 50%;
            border: none;
            font-size: 20px;
            display: grid;
            place-items: center;
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
            cursor: pointer;
            transition: transform .15s ease, background .15s ease;
        }
        .floating-icons button:hover { transform: scale(1.08); background: var(--float-color-hover); }

        .panel-box {
            position: fixed;
            right: 90px;
            top: 50%;
            transform: translateY(-50%);
            width: 420px;
            max-height: 75vh;
            background: white;
            border-radius: 12px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.12);
            overflow: auto;
            padding: 24px;
            z-index: 2100;
            display: none;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.2rem;
        }
        .panel-box.active { display: block; }

        .panel-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
        .panel-header h3 { margin:0; font-size:1.6rem; color:var(--color-oliva-oscuro); }
        .close-panel { background:none; border:none; font-size:1.4rem; cursor:pointer; color:var(--color-oliva-medio); }

        .mission-row { padding:12px; border-radius:8px; margin-bottom:10px; background:#fffaf0; box-shadow: 0 2px 6px rgba(0,0,0,0.04); display:flex; justify-content:space-between; align-items:center; }
        .mission-row.completed { opacity:0.6; text-decoration:line-through; background:#f0fff4; }

        .toast {
            position: fixed;
            right: 20px;
            bottom: 20px;
            background: #fff7e6;
            border-left: 6px solid var(--color-oliva-medio);
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
            z-index: 3000;
            display: none;
            font-size: 1.1rem;
            max-width: 400px;
        }
        .toast.show { display: block; }

        .info { font-family: 'Roboto', sans-serif; color:var(--color-oliva-oscuro); font-size:1.1rem; margin-bottom:12px; }

        /* --- MODAL --- */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--color-crema), #f5efe5);
            margin: 50px auto;
            padding: 30px;
            width: 80%;
            max-width: 800px;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: var(--color-oliva-oscuro);
        }

        .modal-title {
            font-size: 32px;
            margin-bottom: 20px;
            color: var(--color-oliva-oscuro);
            text-align: center;
            font-family: 'Patrick Hand', cursive;
        }

        .modal-description {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--color-oliva-oscuro);
        }

        .modal-description .highlight {
            text-decoration: underline;
            color: var(--color-oliva-medio);
            font-weight: bold;
        }

        .modal-subtopics {
            margin-top: 30px;
        }

        .modal-subtopic {
            background: rgba(190, 192, 146, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .modal-subtopic h4 {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--color-oliva-medio);
            font-family: 'Patrick Hand', cursive;
        }

        .modal-subtopic p {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 15px;
            color: var(--color-oliva-oscuro);
        }

        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .btn {
            background: var(--color-oliva-medio);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Patrick Hand', cursive;
        }

        .btn:hover {
            background: var(--color-oliva-oscuro);
            transform: translateY(-3px);
        }

        .btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        /* --- BARRA DE PROGRESO --- */
        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--color-oliva-claro), var(--color-oliva-medio));
            width: 0%;
            transition: width 0.5s;
        }

        /* --- NOTIFICACI√ìN --- */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(90, 97, 51, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.5s;
            z-index: 3000;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
        }

        .notification.show {
            transform: translateX(0);
        }

        @media (max-width: 1024px) {
            .path-container {
                max-width: 100%;
            }
            
            .panel-box { 
                right: 10px; 
                width: 92%; 
                top: 55%; 
                transform: translateY(-55%); 
            }
            
            .floating-icons { 
                right: 10px; 
            }
        }
    </style>
     <script type="module" src="./global-settings.js"></script>
</head>

<body>
    
    <nav class="navbar">
        <div class="hamburger" id="hamburger-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="user-dropdown" id="user-dropdown">
            <a href="cuenta.html">Mi Cuenta</a>
            <a href="configuracion.html">Configuraci√≥n</a>
            <a href="notificaciones.html">Notificaciones</a>
            <hr>
            <a href="index.html" id="logout-btn">Cerrar Sesi√≥n</a>
        </div>
    </nav>

    <section class="hero-section">
        <img src="logo.jpeg" alt="Logo Sk√≥pia" class="logo-centro">
        <h2 class="bienvenida">¬°BIENVENIDO A LA RUTA DE LECTURA CR√çTICA!</h2>
    </section>

    <main class="main-content">
        <div class="path-container">
            <!-- SVG para la ruta curva -->
            <svg class="curved-path-svg" viewBox="0 0 1200 2000" preserveAspectRatio="none">
                <path d="M 600 50 Q 300 200 200 400 T 150 800 Q 200 1000 400 1200 T 600 1600 Q 800 1800 1000 1900" 
                      stroke="url(#gradient)" stroke-width="8" fill="none" stroke-linecap="round"/>
                <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:var(--color-oliva-claro);stop-opacity:1" />
                        <stop offset="50%" style="stop-color:var(--color-oliva-medio);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:var(--color-oliva-oscuro);stop-opacity:1" />
                    </linearGradient>
                </defs>
            </svg>
            
            <!-- TEMA 1: Comprensi√≥n literal -->
            <div class="path-section" style="left: 50%; top: 50px; transform: translateX(-50%);">
                <div class="topic-node" data-id="1">
                    <span class="node-label">Comprensi√≥n literal</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 1 -->
            <div class="path-section" style="left: 45%; top: 180px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="1-1">
                    <span class="node-label subtopic-label">Ideas principales</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 40%; top: 260px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="1-2">
                    <span class="node-label subtopic-label">Ideas secundarias</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 35%; top: 340px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="1-3">
                    <span class="node-label subtopic-label">Parafraseo</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 30%; top: 420px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="1-4">
                    <span class="node-label subtopic-label">Referencias textuales</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 25%; top: 500px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="1-5">
                    <span class="node-label subtopic-label">Cohesi√≥n textual</span>
                </div>
            </div>
            
            <!-- TEMA 2: Comprensi√≥n inferencial -->
            <div class="path-section" style="left: 20%; top: 600px; transform: translateX(-50%);">
                <div class="topic-node" data-id="2">
                    <span class="node-label">Comprensi√≥n inferencial</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 2 -->
            <div class="path-section" style="left: 18%; top: 720px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="2-1">
                    <span class="node-label subtopic-label">Inferencias de causa-efecto</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 16%; top: 800px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="2-2">
                    <span class="node-label subtopic-label">Prop√≥sito del autor</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 15%; top: 880px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="2-3">
                    <span class="node-label subtopic-label">Inferencias sobre personajes</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 14%; top: 960px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="2-4">
                    <span class="node-label subtopic-label">Suposiciones impl√≠citas</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 13%; top: 1040px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="2-5">
                    <span class="node-label subtopic-label">Interpretaci√≥n de gr√°ficos</span>
                </div>
            </div>
            
            <!-- TEMA 3: Comprensi√≥n cr√≠tica -->
            <div class="path-section" style="left: 15%; top: 1140px; transform: translateX(-50%);">
                <div class="topic-node" data-id="3">
                    <span class="node-label">Comprensi√≥n cr√≠tica</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 3 -->
            <div class="path-section" style="left: 18%; top: 1240px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="3-1">
                    <span class="node-label subtopic-label">Evaluar argumentos</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 22%; top: 1320px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="3-2">
                    <span class="node-label subtopic-label">Detectar falacias</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 28%; top: 1400px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="3-3">
                    <span class="node-label subtopic-label">Perspectiva del autor</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 35%; top: 1480px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="3-4">
                    <span class="node-label subtopic-label">Tono y estilo</span>
                </div>
            </div>
            
            <!-- Examen 1 -->
            <div class="path-section" style="left: 45%; top: 1580px; transform: translateX(-50%);">
                <div class="exam-node" data-id="exam1">
                    <span>Examen 1</span>
                    <p>Puntuaci√≥n m√≠nima: 180/300</p>
                </div>
            </div>
            
            <!-- TEMA 4: Opini√≥n vs hecho -->
            <div class="path-section" style="left: 55%; top: 1680px; transform: translateX(-50%);">
                <div class="topic-node" data-id="4">
                    <span class="node-label">Opini√≥n vs hecho</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 4 -->
            <div class="path-section" style="left: 62%; top: 1760px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="4-1">
                    <span class="node-label subtopic-label">Identificaci√≥n de hechos</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 70%; top: 1840px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="4-2">
                    <span class="node-label subtopic-label">Identificaci√≥n de opiniones</span>
                </div>
            </div>
            
            <!-- Contin√∫a con los dem√°s temas... -->
            <!-- TEMA 5: Estructura del texto -->
            <div class="path-section" style="left: 78%; top: 1920px; transform: translateX(-50%);">
                <div class="topic-node" data-id="5">
                    <span class="node-label">Estructura del texto</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 5 -->
            <div class="path-section" style="left: 85%; top: 2000px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="5-1">
                    <span class="node-label subtopic-label">Partes del texto</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 90%; top: 2080px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="5-2">
                    <span class="node-label subtopic-label">Conectores l√≥gicos</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 95%; top: 2160px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="5-3">
                    <span class="node-label subtopic-label">Transiciones</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 98%; top: 2240px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="5-4">
                    <span class="node-label subtopic-label">Orden l√≥gico</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 100%; top: 2320px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="5-5">
                    <span class="node-label subtopic-label">Tipos de p√°rrafo</span>
                </div>
            </div>
            
            <!-- TEMA 6: Textos narrativos -->
            <div class="path-section" style="left: 98%; top: 2420px; transform: translateX(-50%);">
                <div class="topic-node" data-id="6">
                    <span class="node-label">Textos narrativos</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 6 -->
            <div class="path-section" style="left: 95%; top: 2500px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="6-1">
                    <span class="node-label subtopic-label">Narrador y punto de vista</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 90%; top: 2580px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="6-2">
                    <span class="node-label subtopic-label">Personajes</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 85%; top: 2660px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="6-3">
                    <span class="node-label subtopic-label">Trama y conflicto</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 78%; top: 2740px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="6-4">
                    <span class="node-label subtopic-label">Tiempo narrativo</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 70%; top: 2820px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="6-5">
                    <span class="node-label subtopic-label">Espacio narrativo</span>
                </div>
            </div>
            
            <!-- Examen 2 -->
            <div class="path-section" style="left: 60%; top: 2920px; transform: translateX(-50%);">
                <div class="exam-node" data-id="exam2">
                    <span>Examen 2</span>
                    <p>Puntuaci√≥n m√≠nima: 180/300</p>
                </div>
            </div>
            
            <!-- TEMA 7: Textos expositivos -->
            <div class="path-section" style="left: 50%; top: 3020px; transform: translateX(-50%);">
                <div class="topic-node" data-id="7">
                    <span class="node-label">Textos expositivos</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 7 -->
            <div class="path-section" style="left: 40%; top: 3100px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="7-1">
                    <span class="node-label subtopic-label">Tipos de exposici√≥n</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 30%; top: 3180px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="7-2">
                    <span class="node-label subtopic-label">Objetivo comunicativo</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 22%; top: 3260px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="7-3">
                    <span class="node-label subtopic-label">Recursos explicativos</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 16%; top: 3340px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="7-4">
                    <span class="node-label subtopic-label">Ejemplificaci√≥n</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 12%; top: 3420px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="7-5">
                    <span class="node-label subtopic-label">Definici√≥n y clasificaci√≥n</span>
                </div>
            </div>
            
            <!-- TEMA 8: Textos argumentativos -->
            <div class="path-section" style="left: 10%; top: 3520px; transform: translateX(-50%);">
                <div class="topic-node" data-id="8">
                    <span class="node-label">Textos argumentativos</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 8 -->
            <div class="path-section" style="left: 10%; top: 3600px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="8-1">
                    <span class="node-label subtopic-label">Tesis y argumentos</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 12%; top: 3680px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="8-2">
                    <span class="node-label subtopic-label">Contraargumentos</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 16%; top: 3760px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="8-3">
                    <span class="node-label subtopic-label">Ejemplos de apoyo</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 22%; top: 3840px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="8-4">
                    <span class="node-label subtopic-label">Lenguaje persuasivo</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 30%; top: 3920px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="8-5">
                    <span class="node-label subtopic-label">Conclusiones l√≥gicas</span>
                </div>
            </div>
            
            <!-- TEMA 9: Textos cient√≠ficos -->
            <div class="path-section" style="left: 40%; top: 4020px; transform: translateX(-50%);">
                <div class="topic-node" data-id="9">
                    <span class="node-label">Textos cient√≠ficos</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 9 -->
            <div class="path-section" style="left: 50%; top: 4100px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="9-1">
                    <span class="node-label subtopic-label">Datos y evidencias</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 60%; top: 4180px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="9-2">
                    <span class="node-label subtopic-label">Hip√≥tesis</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 70%; top: 4260px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="9-3">
                    <span class="node-label subtopic-label">Resultados y conclusiones</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 78%; top: 4340px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="9-4">
                    <span class="node-label subtopic-label">Tablas y gr√°ficos</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 85%; top: 4420px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="9-5">
                    <span class="node-label subtopic-label">Lenguaje t√©cnico</span>
                </div>
            </div>
            
            <!-- Examen 3 -->
            <div class="path-section" style="left: 90%; top: 4520px; transform: translateX(-50%);">
                <div class="exam-node" data-id="exam3">
                    <span>Examen 3</span>
                    <p>Puntuaci√≥n m√≠nima: 180/300</p>
                </div>
            </div>
            
            <!-- TEMA 10: Textos period√≠sticos -->
            <div class="path-section" style="left: 95%; top: 4620px; transform: translateX(-50%);">
                <div class="topic-node" data-id="10">
                    <span class="node-label">Textos period√≠sticos</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 10 -->
            <div class="path-section" style="left: 98%; top: 4700px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="10-1">
                    <span class="node-label subtopic-label">Noticia</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 100%; top: 4780px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="10-2">
                    <span class="node-label subtopic-label">Reportaje</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 100%; top: 4860px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="10-3">
                    <span class="node-label subtopic-label">Editorial</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 98%; top: 4940px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="10-4">
                    <span class="node-label subtopic-label">Opini√≥n</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 95%; top: 5020px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="10-5">
                    <span class="node-label subtopic-label">Publicidad</span>
                </div>
            </div>
            
            <!-- TEMA 11: An√°lisis intertextual -->
            <div class="path-section" style="left: 90%; top: 5120px; transform: translateX(-50%);">
                <div class="topic-node" data-id="11">
                    <span class="node-label">An√°lisis intertextual</span>
                </div>
            </div>
            
            <!-- Subtemas del tema 11 -->
            <div class="path-section" style="left: 85%; top: 5200px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="11-1">
                    <span class="node-label subtopic-label">Comparaci√≥n de textos</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 78%; top: 5280px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="11-2">
                    <span class="node-label subtopic-label">Contraste de ideas</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 70%; top: 5360px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="11-3">
                    <span class="node-label subtopic-label">Coincidencias tem√°ticas</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 60%; top: 5440px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="11-4">
                    <span class="node-label subtopic-label">Relaci√≥n de fuentes</span>
                </div>
            </div>
            
            <div class="path-section" style="left: 50%; top: 5520px; transform: translateX(-50%);">
                <div class="subtopic-node" data-id="11-5">
                    <span class="node-label subtopic-label">Referencias culturales</span>
                </div>
            </div>
            
            <!-- Examen Final -->
            <div class="path-section" style="left: 40%; top: 5620px; transform: translateX(-50%);">
                <div class="exam-node" data-id="final-exam">
                    <span>Examen Final</span>
                    <p>Puntuaci√≥n m√≠nima: 180/300</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Barra de progreso -->
    <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
    </div>

    <!-- Notificaci√≥n -->
    <div class="notification" id="notification">
        <p id="notification-text">¬°Bien hecho! Has desbloqueado el siguiente nivel.</p>
    </div>

    <!-- Modal para temas y subtemas -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <span class="close-modal" id="close-modal">&times;</span>
            <h2 class="modal-title" id="modal-title">T√≠tulo del Tema</h2>
            <div class="modal-description" id="modal-description">
                <!-- Contenido din√°mico -->
            </div>
            <div class="modal-subtopics" id="modal-subtopics">
                <!-- Subtemas din√°micos -->
            </div>
            <div class="modal-buttons">
                <button class="btn" id="game-btn">Jugar</button>
                <button class="btn" id="continue-btn">Continuar</button>
            </div>
        </div>
    </div>

    <!-- ADDED: Floating vertical icons -->
    <div class="floating-icons" aria-hidden="false">
        <button id="btn-misiones" title="Misiones">üéØ</button>
        <button id="btn-nivel" title="Nivel actual">‚≠ê</button>
        <button id="btn-progreso" title="Progreso">üìä</button>
        <button id="btn-analisis" title="An√°lisis">üìà</button>
    </div>

    <!-- ADDED: Panel Misiones -->
    <div class="panel-box" id="panel-misiones" aria-hidden="true">
        <div class="panel-header">
            <h3>Misiones</h3>
            <button class="close-panel" data-close="misiones">&times;</button>
        </div>
        <div id="misiones-content">
            <!-- missions list injected by JS -->
        </div>
    </div>

    <!-- ADDED: Panel Nivel -->
    <div class="panel-box" id="panel-nivel" aria-hidden="true">
        <div class="panel-header">
            <h3>Tu nivel</h3>
            <button class="close-panel" data-close="nivel">&times;</button>
        </div>
        <div id="nivel-content">
            <!-- level info injected by JS -->
        </div>
    </div>

    <!-- ADDED: Panel Progreso -->
    <div class="panel-box" id="panel-progreso" aria-hidden="true">
        <div class="panel-header">
            <h3>Progreso</h3>
            <button class="close-panel" data-close="progreso">&times;</button>
        </div>
        <div id="progreso-content">
            <!-- progress injected by JS -->
        </div>
    </div>

    <!-- ADDED: Panel Analisis -->
    <div class="panel-box" id="panel-analisis" aria-hidden="true">
        <div class="panel-header">
            <h3>An√°lisis (promedio 0‚Äì300)</h3>
            <button class="close-panel" data-close="analisis">&times;</button>
        </div>
        <div id="analisis-content">
            <!-- analysis injected by JS -->
            <div id="analisis-stats" style="margin-top:12px;"></div>
        </div>
    </div>

    <!-- ADDED: Toast notification for mission completed -->
    <div class="toast" id="mission-toast" role="status" aria-live="polite"></div>

    <script>
        /*************************************************************************
         *  LOCAL DATA: 100 missions (fixed values taken from the updated list)
         *  Each mission: { id, title, points, completed }
         *************************************************************************/
        const MISSIONS_KEY = 'skopia_missions_v1';
        const EXAMS_KEY = 'skopia_exam_scores_by_tag_v1';
        const PROGRESS_KEY = 'skopia_lectura_critica_progress_v1';

        const missionsTemplate = [
            { id: 1, title: "Completa tu primer examen", points: 50 },
            { id: 2, title: "Logra al menos 180/300 en un examen", points: 80 },
            { id: 3, title: "Lee toda la teor√≠a de una lecci√≥n", points: 40 },
            { id: 4, title: "Termina una sesi√≥n de estudio sin salir", points: 50 },
            { id: 5, title: "Gana tu primer juego", points: 50 },
            { id: 6, title: "Usa una pista o ayuda en un juego", points: 30 },
            { id: 7, title: "Repite un examen para mejorar tu nota", points: 50 },
            { id: 8, title: "Cambia tu nombre de usuario", points: 40 },
            { id: 9, title: "Acumula tus primeras 200 estrellas", points: 30 },
            { id: 10, title: "Completa 3 misiones seguidas", points: 50 },

            { id: 11, title: "Logra 240/300 en un examen", points: 150 },
            { id: 12, title: "Completa un examen sin errores (300/300)", points: 200 },
            { id: 13, title: "Gana 3 juegos distintos", points: 60 },
            { id: 14, title: "Termina una teor√≠a con ejemplo pr√°ctico", points: 40 },
            { id: 15, title: "Participa en una pr√°ctica de repaso", points: 30 },
            { id: 16, title: "Completa 2 ex√°menes el mismo d√≠a", points: 80 },
            { id: 17, title: "Obt√©n 500 estrellas acumuladas", points: 50 },
            { id: 18, title: "Gana un juego en menos de 2 minutos", points: 50 },
            { id: 19, title: "Repite un juego hasta mejorar tu resultado", points: 30 },
            { id: 20, title: "Completa todas las misiones del nivel 1", points: 100 },

            { id: 21, title: "Logra 270/300 en un examen", points: 180 },
            { id: 22, title: "Supera tu propia mejor nota", points: 60 },
            { id: 23, title: "Termina 5 juegos de pr√°ctica", points: 50 },
            { id: 24, title: "Lee toda la teor√≠a sin usar pistas", points: 40 },
            { id: 25, title: "Completa todos los subniveles de un tema (5/5)", points: 100 },
            { id: 26, title: "Suma 1000 estrellas totales", points: 50 },
            { id: 27, title: "Gana un examen con tiempo limitado", points: 80 },
            { id: 28, title: "Juega y gana el modo "escape room"", points: 60 },
            { id: 29, title: "Completa un juego de ahorcado correctamente", points: 50 },
            { id: 30, title: "Haz un examen de repaso general", points: 70 },

            { id: 31, title: "Logra 300/300 en dos ex√°menes seguidos", points: 200 },
            { id: 32, title: "Completa todos los juegos de un m√≥dulo", points: 100 },
            { id: 33, title: "Termina la teor√≠a de un m√≥dulo completo", points: 80 },
            { id: 34, title: "Gana un juego tipo tablero", points: 60 },
            { id: 35, title: "Completa una misi√≥n cronometrada", points: 80 },
            { id: 36, title: "Obt√©n 2000 estrellas acumuladas", points: 60 },
            { id: 37, title: "Gana un juego sin usar pistas", points: 50 },
            { id: 38, title: "Revisa tu historial de progreso", points: 30 },
            { id: 39, title: "Completa 10 misiones seguidas sin fallar", points: 100 },
            { id: 40, title: "Termina un examen con todos los tiempos perfectos", points: 150 },

            { id: 41, title: "Completa 5 ex√°menes con m√°s de 240/300", points: 150 },
            { id: 42, title: "Termina todos los subniveles del nivel 6", points: 140 },
            { id: 43, title: "Consigue 3000 estrellas", points: 120 },
            { id: 44, title: "Estudia 10 d√≠as seguidos", points: 130 },
            { id: 45, title: "Completa 10 misiones", points: 140 },
            { id: 46, title: "Llega al nivel 6.5", points: 130 },
            { id: 47, title: "Termina un examen sin errores", points: 150 },
            { id: 48, title: "Supera tu propio puntaje anterior", points: 140 },
            { id: 49, title: "Contesta 500 preguntas", points: 130 },
            { id: 50, title: "Completa un examen en menos de 25 minutos", points: 140 },

            { id: 51, title: "Alcanza el top 10 por primera vez (local)", points: 150 },
            { id: 52, title: "Mantente en el top 10 por 3 d√≠as (local)", points: 140 },
            { id: 53, title: "Gana 4000 estrellas", points: 130 },
            { id: 54, title: "Termina la ruta RC con promedio ‚â•200", points: 140 },
            { id: 55, title: "Termina la ruta LC con promedio ‚â•200", points: 140 },
            { id: 56, title: "Termina la ruta CC con promedio ‚â•200", points: 140 },
            { id: 57, title: "Obt√©n 250 puntos o m√°s en tres rutas", points: 150 },
            { id: 58, title: "Crea una racha de 20 aciertos seguidos", points: 140 },
            { id: 59, title: "Completa 15 misiones", points: 130 },
            { id: 60, title: "Alcanza el nivel 7", points: 150 },

            { id: 61, title: "Consigue 6000 estrellas", points: 160 },
            { id: 62, title: "Estudia 20 d√≠as seguidos", points: 170 },
            { id: 63, title: "Termina todos los niveles de una ruta (10/10)", points: 180 },
            { id: 64, title: "Contesta 1000 preguntas", points: 160 },
            { id: 65, title: "Supera a 5 usuarios en el ranking (local)", points: 170 },
            { id: 66, title: "Alcanza el nivel 8", points: 170 },
            { id: 67, title: "Termina 20 misiones", points: 160 },
            { id: 68, title: "Obt√©n promedio ‚â•250 puntos en una ruta", points: 180 },
            { id: 69, title: "Logra 5 ex√°menes con 250 o m√°s puntos", points: 170 },
            { id: 70, title: "Termina las rutas RC y LC completas", points: 180 },

            { id: 71, title: "Mantente en el top 5 (local)", points: 170 },
            { id: 72, title: "Completa todos los subniveles (50 total)", points: 180 },
            { id: 73, title: "Gana 8000 estrellas", points: 160 },
            { id: 74, title: "Termina 25 misiones", points: 170 },
            { id: 75, title: "Sube de nivel sin fallar un examen", points: 160 },
            { id: 76, title: "Obt√©n 280 puntos en un examen", points: 180 },
            { id: 77, title: "Completa 10 ex√°menes sin pistas", points: 170 },
            { id: 78, title: "Obt√©n 270 o m√°s en las tres rutas", points: 180 },
            { id: 79, title: "Alcanza el nivel 9", points: 180 },
            { id: 80, title: "Termina 30 misiones", points: 170 },

            { id: 81, title: "Gana 10,000 estrellas", points: 190 },
            { id: 82, title: "Mantente en el top 3 (local)", points: 190 },
            { id: 83, title: "Termina las tres rutas con promedio ‚â•250", points: 190 },
            { id: 84, title: "Completa los 50 subniveles con m√°s de 200 puntos promedio", points: 200 },
            { id: 85, title: "Llega al nivel 10", points: 200 },
            { id: 86, title: "Gana 15,000 estrellas", points: 200 },
            { id: 87, title: "Mantente en el top 3 por 7 d√≠as (local)", points: 190 },
            { id: 88, title: "Consigue 300 puntos en un examen", points: 200 },
            { id: 89, title: "Termina 40 misiones", points: 190 },
            { id: 90, title: "Completa todos los ex√°menes de pr√°ctica", points: 190 },

            { id: 91, title: "Llega a 20,000 estrellas", points: 200 },
            { id: 92, title: "Termina 50 misiones", points: 190 },
            { id: 93, title: "Mantente en el top 1 por 3 d√≠as (local)", points: 200 },
            { id: 94, title: "Termina todas las rutas al 100%", points: 200 },
            { id: 95, title: "Obt√©n todas las medallas", points: 190 },
            { id: 96, title: "Consigue 25,000 estrellas", points: 200 },
            { id: 97, title: "Cumple todas las misiones b√°sicas e intermedias", points: 190 },
            { id: 98, title: "Mantente activo 30 d√≠as seguidos", points: 200 },
            { id: 99, title: "Llega a 30,000 estrellas", points: 200 },
            { id: 100, title: "üèÜ Maestro del Saber Pro: completa todo el sistema", points: 200 }
        ];

        // Level thresholds as defined earlier
        const LEVELS = [
            { idx: 1, name: "Novato/a", min: 0, max: 299 },
            { idx: 2, name: "Aprendiz/a", min: 300, max: 799 },
            { idx: 3, name: "Explorador/a", min: 800, max: 1499 },
            { idx: 4, name: "Analista", min: 1500, max: 2499 },
            { idx: 5, name: "Estratega", min: 2500, max: 3699 },
            { idx: 6, name: "Sabio/a", min: 3700, max: 4999 },
            { idx: 7, name: "Maestro/a", min: 5000, max: 6499 },
            { idx: 8, name: "√âlite", min: 6500, max: 7999 },
            { idx: 9, name: "Leyenda", min: 8000, max: 9499 },
            { idx: 10, name: "Rey/Reina Sk√≥pia", min: 9500, max: Infinity }
        ];

        // Estado del progreso del usuario
        function getUserProgress() {
            const stored = localStorage.getItem(PROGRESS_KEY);
            if (stored) {
                return JSON.parse(stored);
            }
            
            // Valores por defecto
            return {
                currentModule: 1,
                currentSubtopic: null,
                completedModules: [],
                completedSubtopics: [],
                examScores: {
                    exam1: null,
                    exam2: null,
                    exam3: null,
                    finalExam: null
                }
            };
        }

        function saveUserProgress(progress) {
            localStorage.setItem(PROGRESS_KEY, JSON.stringify(progress));
        }

        // Contenido de los temas y subtemas
        const topicsContent = {
            1: {
                title: "Comprensi√≥n literal",
                description: "La comprensi√≥n literal es la habilidad de <span class='highlight'>identificar y entender informaci√≥n expl√≠cita</span> en un texto. Esta habilidad fundamental nos permite extraer datos, hechos y detalles que se presentan directamente en el material de lectura sin necesidad de hacer interpretaciones o inferencias. La comprensi√≥n literal es la base sobre la cual se construyen niveles m√°s complejos de comprensi√≥n lectora.",
                subtopics: {
                    "1-1": {
                        title: "Ideas principales",
                        description: "Las ideas principales son los conceptos centrales o mensajes m√°s importantes que el autor quiere transmitir. Identificarlas nos permite entender el prop√≥sito fundamental del texto. Por ejemplo, en un art√≠culo sobre los efectos del cambio clim√°tico, la idea principal podr√≠a ser que las actividades humanas est√°n acelerando el calentamiento global y sus consecuencias son graves para el planeta."
                    },
                    "1-2": {
                        title: "Ideas secundarias",
                        description: "Las ideas secundarias son detalles que complementan, explican o desarrollan las ideas principales. Proporcionan contexto, ejemplos o informaci√≥n adicional. Siguiendo el ejemplo anterior, las ideas secundarias podr√≠an incluir datos sobre el aumento de temperatura, el derretimiento de glaciares o los patrones clim√°ticos alterados."
                    },
                    "1-3": {
                        title: "Parafraseo",
                        description: "El parafraseo es la habilidad de expresar una idea con palabras diferentes manteniendo el mismo significado. Esta t√©cnica demuestra comprensi√≥n y ayuda a internalizar la informaci√≥n. Por ejemplo, si el texto dice 'El cambio clim√°tico representa una amenaza existencial para la biodiversidad', un parafraseo podr√≠a ser 'La diversidad biol√≥gica est√° en peligro debido al cambio clim√°tico'."
                    },
                    "1-4": {
                        title: "Referencias textuales",
                        description: "Las referencias textuales son elementos dentro del texto que remiten a otra parte del mismo o a informaci√≥n externa. Pueden ser pronombres, sin√≥nimos o conectores que establecen relaciones. Identificarlas es crucial para seguir el hilo argumentativo y entender c√≥mo se conectan las diferentes partes del texto."
                    },
                    "1-5": {
                        title: "Cohesi√≥n textual",
                        description: "La cohesi√≥n textual se refiere a las conexiones ling√º√≠sticas que unen las diferentes partes de un texto, haci√©ndolo coherente. Incluye el uso de conectores, la repetici√≥n de t√©rminos y la referencia cruzada. Un texto cohesionado fluye naturalmente y facilita la comprensi√≥n del lector."
                    }
                }
            },
            2: {
                title: "Comprensi√≥n inferencial",
                description: "La comprensi√≥n inferencial va m√°s all√° de lo expl√≠cito y nos permite <span class='highlight'>deducir informaci√≥n impl√≠cita</span> a partir de las pistas que ofrece el texto. Esta habilidad requiere conectar ideas, hacer suposiciones l√≥gicas y 'leer entre l√≠neas'. La inferencia es fundamental para una comprensi√≥n profunda, ya que muchos textos no expresan todo directamente y conf√≠an en que el lector complete la informaci√≥n utilizando su conocimiento previo y las pistas contextuales.",
                subtopics: {
                    "2-1": {
                        title: "Inferencias de causa-efecto",
                        description: "Las inferencias de causa-efecto nos permiten identificar relaciones no expl√≠citas entre eventos o situaciones. Por ejemplo, si un texto describe que 'las calles estaban inundadas y la gente llevaba paraguas', podemos inferir que ha estado lloviendo intensamente, aunque el texto no lo mencione directamente."
                    },
                    "2-2": {
                        title: "Prop√≥sito del autor",
                        description: "Identificar el prop√≥sito del autor implica deducir por qu√© escribi√≥ el texto: para informar, persuadir, entretener, advertir, etc. Esto se infiere del tono, la selecci√≥n de informaci√≥n y la estructura del texto. Por ejemplo, un texto que presenta principalmente datos estad√≠sticos y hechos objetivos probablemente tenga un prop√≥sito informativo."
                    },
                    "2-3": {
                        title: "Inferencias sobre personajes",
                        description: "En textos narrativos, podemos inferir caracter√≠sticas de los personajes a trav√©s de sus acciones, di√°logos y c√≥mo otros los describen. Si un personaje 'siempre llegaba temprano y organizaba su material meticulosamente', podemos inferir que es una persona ordenada y responsable, aunque el texto no lo diga expl√≠citamente."
                    },
                    "2-4": {
                        title: "Suposiciones impl√≠citas",
                        description: "Las suposiciones impl√≠citas son creencias o ideas que el autor da por sentadas y no expresa directamente. Identificarlas nos permite entender el marco ideol√≥gico desde el cual se produce el texto. Por ejemplo, un art√≠culo que promueve el consumo de productos org√°nicos asume impl√≠citamente que los alimentos no org√°nicos son menos saludables."
                    },
                    "2-5": {
                        title: "Interpretaci√≥n de gr√°ficos",
                        description: "La interpretaci√≥n de gr√°ficos requiere inferir informaci√≥n a partir de representaciones visuales de datos. Esto incluye identificar tendencias, comparar valores y sacar conclusiones basadas en la informaci√≥n presentada visualmente. Por ejemplo, de un gr√°fico de barras que muestra el aumento de temperatura anual, podemos inferir el calentamiento global."
                    }
                }
            },
            3: {
                title: "Comprensi√≥n cr√≠tica",
                description: "La comprensi√≥n cr√≠tica es la habilidad de <span class='highlight'>evaluar y juzgar la calidad, validez y relevancia</span> de la informaci√≥n presentada en un texto. Implica cuestionar lo que leemos, identificar sesgos, evaluar argumentos y formar una opini√≥n informada. Esta habilidad es esencial en un mundo saturado de informaci√≥n, ya que nos permite distinguir entre fuentes fiables y no fiables, y desarrollar un pensamiento independiente.",
                subtopics: {
                    "3-1": {
                        title: "Evaluar argumentos",
                        description: "Evaluar argumentos implica analizar la l√≥gica, la evidencia y la estructura de los razonamientos presentados. Debemos preguntarnos: ¬øEl argumento est√° bien fundamentado? ¬øLa evidencia es suficiente y relevante? ¬øExisten contraargumentos no considerados? Por ejemplo, ante el argumento 'Debemos prohibir los pl√°sticos porque contaminan', una evaluaci√≥n cr√≠tica considerar√≠a tambi√©n los beneficios de los pl√°sticos y alternativas viables."
                    },
                    "3-2": {
                        title: "Detectar falacias",
                        description: "Las falacias son errores en el razonamiento que hacen un argumento inv√°lido o enga√±oso. Identificarlas es crucial para no ser manipulado. Ejemplos comunes incluyen el ataque personal (criticar a la persona en lugar del argumento), la falsa dicotom√≠a (presentar solo dos opciones cuando hay m√°s) o la generalizaci√≥n apresurada (concluir algo a partir de casos insuficientes)."
                    },
                    "3-3": {
                        title: "Perspectiva del autor",
                        description: "Identificar la perspectiva del autor nos permite entender desde qu√© punto de vista se presenta la informaci√≥n. Esto incluye considerar su contexto cultural, ideol√≥gico, profesional o personal. Por ejemplo, un economista neoliberal y un economista keynesiano analizar√°n el mismo fen√≥meno econ√≥mico desde perspectivas diferentes, lo que influir√° en sus conclusiones."
                    },
                    "3-4": {
                        title: "Tono y estilo",
                        description: "El tono y estilo de un texto revelan mucho sobre la intenci√≥n del autor y su actitud hacia el tema. Un tono puede ser objetivo, subjetivo, ir√≥nico, emotivo, etc. Por ejemplo, un texto con un tono alarmista y lenguaje dram√°tico sobre un tema probablemente busca persuadir emocionalmente m√°s que informar objetivamente."
                    }
                }
            },
            4: {
                title: "Opini√≥n vs hecho",
                description: "Diferenciar entre opiniones y hechos es una habilidad fundamental en la lectura cr√≠tica. Un <span class='highlight'>hecho es una afirmaci√≥n verificable</span> que puede demostrarse como verdadera o falsa, mientras que una <span class='highlight'>opini√≥n es un juicio personal</span> basado en creencias, valores o sentimientos. Esta distinci√≥n nos permite evaluar la objetividad de un texto y reconocer cu√°ndo estamos ante informaci√≥n comprobable y cu√°ndo ante interpretaciones subjetivas.",
                subtopics: {
                    "4-1": {
                        title: "Identificaci√≥n de hechos",
                        description: "Los hechos son afirmaciones objetivas que pueden verificarse mediante evidencia emp√≠rica, datos o fuentes fiables. Suelen incluir cifras, fechas, nombres o descripciones concretas. Por ejemplo, 'La Tierra gira alrededor del Sol' es un hecho verificable cient√≠ficamente. Para identificar hechos, buscamos indicadores como datos espec√≠ficos, referencias a estudios o fuentes citadas."
                    },
                    "4-2": {
                        title: "Identificaci√≥n de opiniones",
                        description: "Las opiniones expresan juicios de valor, preferencias o interpretaciones subjetivas. A menudo contienen palabras calificativas como 'bueno', 'malo', 'deber√≠a', 'mejor', 'peor', etc. Por ejemplo, 'El chocolate es la mejor golosina' es una opini√≥n. Las opiniones no pueden demostrarse como verdaderas o falsas de manera objetiva, ya que dependen de la perspectiva de quien las emite."
                    },
                    "4-3": {
                        title: "An√°lisis de sesgos",
                        description: "El sesgo es una inclinaci√≥n o predisposici√≥n que afecta la objetividad. Puede manifestarse en la selecci√≥n de informaci√≥n, el uso de lenguaje emotivo o la omisi√≥n de perspectivas alternativas. Identificar sesgos nos permite entender qu√© factores est√°n influyendo en la presentaci√≥n de la informaci√≥n. Por ejemplo, un art√≠culo que solo presenta beneficios de un producto sin mencionar desventajas muestra un sesgo positivo."
                    },
                    "4-4": {
                        title: "Validaci√≥n de informaci√≥n",
                        description: "Validar informaci√≥n implica verificar la veracidad y fiabilidad de los datos presentados. Esto incluye consultar fuentes primarias, cruzar informaci√≥n con diferentes medios y evaluar la credibilidad de los autores. En la era digital, esta habilidad es crucial para combatir la desinformaci√≥n. Por ejemplo, ante una noticia sorprendente, validar√≠amos buscando cobertura en medios de comunicaci√≥n reconocidos y verificando las fuentes originales."
                    }
                }
            },
            5: {
                title: "Estructura del texto",
                description: "La estructura de un texto se refiere a la <span class='highlight'>organizaci√≥n y disposici√≥n de sus elementos</span>. Comprender esta estructura nos facilita la lectura y nos permite identificar las relaciones entre las diferentes partes del texto. Los textos pueden organizarse de diversas maneras seg√∫n su prop√≥sito: cronol√≥gicamente, por orden de importancia, de lo general a lo particular, por comparaci√≥n y contraste, etc. Reconocer la estructura nos ayuda a anticipar la informaci√≥n y a retener mejor los contenidos.",
                subtopics: {
                    "5-1": {
                        title: "Partes del texto",
                        description: "La mayor√≠a de los textos acad√©micos y formales siguen una estructura b√°sica: introducci√≥n, desarrollo y conclusi√≥n. La introducci√≥n presenta el tema y el prop√≥sito, el desarrollo desarrolla las ideas principales con detalles y ejemplos, y la conclusi√≥n resume y cierra el texto. Identificar estas partes nos ayuda a seguir el hilo argumentativo y a comprender la organizaci√≥n global del texto."
                    },
                    "5-2": {
                        title: "Conectores l√≥gicos",
                        description: "Los conectores l√≥gicos son palabras o frases que establecen relaciones entre ideas: causa (porque, ya que), consecuencia (por lo tanto, as√≠), contraste (sin embargo, no obstante), adici√≥n (adem√°s, tambi√©n), etc. Estos elementos son como se√±ales que gu√≠an al lector a trav√©s del texto, indicando c√≥mo se relacionan las diferentes ideas. Su uso adecuado hace que un texto sea m√°s coherente y f√°cil de seguir."
                    },
                    "5-3": {
                        title: "Transiciones",
                        description: "Las transiciones son frases o p√°rrafos que conectan diferentes secciones de un texto, facilitando el paso de una idea a otra. Pueden ser expl√≠citas ('En segundo lugar', 'Por otro lado') o impl√≠citas, basadas en la continuidad tem√°tica. Las transiciones bien construidas mantienen el flujo del texto y ayudan al lector a seguir el razonamiento del autor sin perderse."
                    },
                    "5-4": {
                        title: "Orden l√≥gico",
                        description: "El orden l√≥gico se refiere a la secuencia en que se presentan las ideas para que el texto sea coherente y f√°cil de seguir. Puede ser cronol√≥gico (para narraciones), deductivo (de lo general a lo particular), inductivo (de lo particular a lo general), por problema-soluci√≥n, por comparaci√≥n-contraste, etc. Identificar el orden l√≥gico nos ayuda a anticipar la informaci√≥n y a comprender mejor la estructura argumentativa."
                    },
                    "5-5": {
                        title: "Tipos de p√°rrafo",
                        description: "Los p√°rrafos pueden clasificarse seg√∫n su funci√≥n: narrativos (relatan sucesos), descriptivos (presentan caracter√≠sticas), expositivos (explican conceptos), argumentativos (defienden una postura), etc. Reconocer el tipo de p√°rrafo nos ayuda a entender su prop√≥sito dentro del texto y a adaptar nuestra estrategia de lectura. Por ejemplo, un p√°rrafo argumentativo requiere una lectura m√°s cr√≠tica que un p√°rrafo descriptivo."
                    }
                }
            },
            6: {
                title: "Textos narrativos",
                description: "Los textos narrativos son aquellos que <span class='highlight'>relatan sucesos o historias</span>, reales o imaginarias. Su prop√≥sito principal es entretener, pero tambi√©n pueden transmitir valores, ense√±anzas o reflexiones. Los elementos fundamentales de la narraci√≥n son el narrador, los personajes, el espacio, el tiempo y la trama. Comprender c√≥mo estos elementos interact√∫an nos permite analizar m√°s profundamente el significado y la intenci√≥n de la narraci√≥n.",
                subtopics: {
                    "6-1": {
                        title: "Narrador y punto de vista",
                        description: "El narrador es la voz que cuenta la historia y puede adoptar diferentes puntos de vista: primera persona (el narrador es un personaje), segunda persona (se dirige directamente al lector) o tercera persona (externo a la historia). Adem√°s, puede ser omnisciente (sabe todo sobre los personajes y pensamientos) o limitado (conoce solo lo que un personaje sabe). El punto de vista influye enormemente en c√≥mo percibimos la historia."
                    },
                    "6-2": {
                        title: "Personajes",
                        description: "Los personajes son los seres que participan en la narraci√≥n. Pueden ser principales o secundarios, planos (poco desarrollados) o redondos (complejos y evolucionan). Su caracterizaci√≥n puede ser directa (el narrador describe sus rasgos) o indirecta (se revela a trav√©s de sus acciones, di√°logos o pensamientos). Analizar los personajes nos permite entender sus motivaciones y su papel en el desarrollo de la trama."
                    },
                    "6-3": {
                        title: "Trama y conflicto",
                        description: "La trama es la secuencia de eventos que constituyen la narraci√≥n. Generalmente sigue una estructura: planteamiento (presentaci√≥n), nudo (desarrollo del conflicto) y desenlace (resoluci√≥n). El conflicto es el problema o tensi√≥n que impulsa la acci√≥n y puede ser interno (dentro de un personaje) o externo (entre personajes o contra el entorno). Identificar la trama y el conflicto nos ayuda a seguir el desarrollo de la historia."
                    },
                    "6-4": {
                        title: "Tiempo narrativo",
                        description: "El tiempo narrativo se refiere a cu√°ndo ocurren los eventos y c√≥mo se presentan. Puede ser lineal (cronol√≥gico) o no lineal (con saltos en el tiempo como flashbacks o flashforwards). Tambi√©n hay que distinguir entre el tiempo de la historia (duraci√≥n de los eventos) y el tiempo del relato (longitud del texto para narrarlos). El manejo del tiempo influye en el ritmo y la tensi√≥n narrativa."
                    },
                    "6-5": {
                        title: "Espacio narrativo",
                        description: "El espacio narrativo es el lugar o lugares donde transcurre la acci√≥n. Puede ser f√≠sico (geogr√°fico) o social (el entorno cultural, econ√≥mico, etc.). El espacio no es solo un fondo, sino que puede influir en los personajes y la trama, crear atm√≥sferas o simbolizar aspectos de la historia. Por ejemplo, un espacio opresivo puede reflejar el estado emocional de los personajes."
                    }
                }
            },
            7: {
                title: "Textos expositivos",
                description: "Los textos expositivos tienen como funci√≥n principal <span class='highlight'>explicar, informar o transmitir conocimientos</span> sobre un tema de manera objetiva y clara. Su estructura suele ser l√≥gica y organizada, y utilizan recursos como definiciones, clasificaciones, comparaciones y ejemplos para facilitar la comprensi√≥n. Los textos expositivos son comunes en el √°mbito acad√©mico, cient√≠fico y period√≠stico, y dominar su comprensi√≥n es fundamental para el aprendizaje en cualquier disciplina.",
                subtopics: {
                    "7-1": {
                        title: "Tipos de exposici√≥n",
                        description: "Existen diferentes tipos de exposici√≥n seg√∫n su prop√≥sito: definici√≥n (explica qu√© es algo), descripci√≥n (presenta caracter√≠sticas), narraci√≥n (relata sucesos), comparaci√≥n-contraste (semejanzas y diferencias), causa-efecto (relaciones entre eventos), problema-soluci√≥n (presenta un problema y posibles soluciones), etc. Identificar el tipo de exposici√≥n nos ayuda a anticipar la estructura y a enfocar nuestra atenci√≥n en los aspectos m√°s relevantes."
                    },
                    "7-2": {
                        title: "Objetivo comunicativo",
                        description: "El objetivo comunicativo de un texto expositivo es transmitir informaci√≥n de manera clara, precisa y objetiva. Para lograrlo, el autor debe organizar las ideas l√≥gicamente, usar un lenguaje adecuado al p√∫blico y evitar ambig√ºedades. Reconocer el objetivo nos permite entender qu√© informaci√≥n es prioritaria y c√≥mo se relacionan los diferentes elementos del texto."
                    },
                    "7-3": {
                        title: "Recursos explicativos",
                        description: "Los recursos explicativos son herramientas que facilitan la comprensi√≥n: definiciones, ejemplos, analog√≠as, comparaciones, clasificaciones, etc. Por ejemplo, para explicar un concepto complejo, el autor puede usar una analog√≠a ('el √°tomo es como un sistema solar en miniatura') o proporcionar ejemplos concretos. Identificar estos recursos nos ayuda a comprender mejor los conceptos abstractos o dif√≠ciles."
                    },
                    "7-4": {
                        title: "Ejemplificaci√≥n",
                        description: "La ejemplificaci√≥n consiste en presentar casos concretos que ilustran una idea general. Los ejemplos hacen que la informaci√≥n sea m√°s comprensible y memorable. Por ejemplo, al explicar los tipos de energ√≠a renovable, se pueden mencionar ejemplos como la solar, e√≥lica o hidroel√©ctrica. Reconocer los ejemplos nos ayuda a aplicar los conceptos a situaciones reales."
                    },
                    "7-5": {
                        title: "Definici√≥n y clasificaci√≥n",
                        description: "La definici√≥n explica el significado de un t√©rmino, mientras que la clasificaci√≥n agrupa objetos o conceptos seg√∫n caracter√≠sticas comunes. Ambos recursos son fundamentales en los textos expositivos para organizar la informaci√≥n. Por ejemplo, un texto puede definir qu√© es un ecosistema y luego clasificar los diferentes tipos (terrestres, acu√°ticos, etc.). Identificar definiciones y clasificaciones nos ayuda a estructurar mentalmente la informaci√≥n."
                    }
                }
            },
            8: {
                title: "Textos argumentativos",
                description: "Los textos argumentativos tienen como objetivo <span class='highlight'>convencer al lector de una postura</span> mediante la presentaci√≥n de argumentos y evidencias. A diferencia de los textos expositivos, que solo informan, los argumentativos buscan persuadir y suelen presentar una tesis clara que se defiende con razonamientos, pruebas y refutaci√≥n de posibles objeciones. Dominar la comprensi√≥n de estos textos es fundamental para desarrollar un pensamiento cr√≠tico y no ser f√°cilmente manipulado por la persuasi√≥n.",
                subtopics: {
                    "8-1": {
                        title: "Tesis y argumentos",
                        description: "La tesis es la idea principal o postura que el autor defiende, mientras que los argumentos son las razones que la apoyan. Una tesis debe ser clara, espec√≠fica y discutible. Los argumentos pueden basarse en hechos, estad√≠sticas, ejemplos, autoridades o razonamientos l√≥gicos. Identificar la tesis y los argumentos nos permite evaluar la solidez de la posici√≥n del autor."
                    },
                    "8-2": {
                        title: "Contraargumentos",
                        description: "Los contraargumentos son posibles objeciones a la tesis que el autor puede anticipar y refutar. Presentar y rebatir contraargumentos fortalece la posici√≥n del autor al demostrar que ha considerado diferentes perspectivas. Por ejemplo, en un ensayo que defiende el vegetarianismo, un contraargumento podr√≠a ser 'la carne es necesaria para la salud', que el autor refutar√≠a presentando evidencia sobre dietas vegetarianas saludables."
                    },
                    "8-3": {
                        title: "Ejemplos de apoyo",
                        description: "Los ejemplos de apoyo son casos concretos que ilustran o demuestran los argumentos. Pueden ser estad√≠sticas, estudios, casos hist√≥ricos, situaciones hipot√©ticas, etc. Un buen ejemplo debe ser relevante, representativo y explicado claramente. Por ejemplo, al argumentar sobre los efectos del cambio clim√°tico, se pueden citar ejemplos como el derretimiento de los polos o el aumento de eventos clim√°ticos extremos."
                    },
                    "8-4": {
                        title: "Lenguaje persuasivo",
                        description: "El lenguaje persuasivo utiliza recursos ret√≥ricos para influir en la actitud o comportamiento del lector. Incluye el uso de emotividad, preguntas ret√≥ricas, met√°foras, repetici√≥n, apelaciones a la autoridad o a los valores del p√∫blico. Identificar estos recursos nos permite reconocer cu√°ndo se est√° intentando persuadirnos y evaluar si los argumentos son s√≥lidos o si se basan principalmente en manipulaci√≥n emocional."
                    },
                    "8-5": {
                        title: "Conclusiones l√≥gicas",
                        description: "Las conclusiones l√≥gicas son las inferencias que se derivan necesariamente de las premisas presentadas. En un texto argumentativo, la conclusi√≥n debe seguir coherentemente de los argumentos y evidencias presentados. Evaluar si las conclusiones son l√≥gicas nos permite determinar si el razonamiento del autor es v√°lido o si hay saltos l√≥gicos o conclusiones no justificadas."
                    }
                }
            },
            9: {
                title: "Textos cient√≠ficos",
                description: "Los textos cient√≠ficos comunican <span class='highlight'>resultados de investigaciones, teor√≠as y descubrimientos</span> en el √°mbito cient√≠fico. Se caracterizan por su precisi√≥n, objetividad y uso de un lenguaje t√©cnico especializado. Comprender estos textos requiere familiarizarse con su estructura espec√≠fica (introducci√≥n, m√©todos, resultados, discusi√≥n) y con las convenciones de la comunicaci√≥n cient√≠fica. Esta habilidad es esencial para mantenerse informado sobre avances cient√≠ficos y para participar en debates basados en evidencia.",
                subtopics: {
                    "9-1": {
                        title: "Datos y evidencias",
                        description: "Los datos y evidencias son la base de los textos cient√≠ficos. Pueden ser cuantitativos (n√∫meros, mediciones) o cualitativos (observaciones, descripciones). La evidencia cient√≠fica debe ser sistem√°tica, replicable y objetiva. Al leer un texto cient√≠fico, es crucial evaluar la calidad y relevancia de los datos presentados: ¬øc√≥mo se recolectaron? ¬øson suficientes? ¬øhay posibles sesgos en su recolecci√≥n o interpretaci√≥n?"
                    },
                    "9-2": {
                        title: "Hip√≥tesis",
                        description: "Una hip√≥tesis es una explicaci√≥n provisional de un fen√≥meno que se pone a prueba mediante la investigaci√≥n. Debe ser espec√≠fica, comprobable y falsable. En los textos cient√≠ficos, las hip√≥tesis gu√≠an la investigaci√≥n y su confirmaci√≥n o refutaci√≥n contribuye al conocimiento. Identificar las hip√≥tesis nos permite entender qu√© preguntas est√° tratando de responder la investigaci√≥n y c√≥mo se relacionan los resultados con estas preguntas iniciales."
                    },
                    "9-3": {
                        title: "Resultados y conclusiones",
                        description: "Los resultados son los hallazgos brutos de la investigaci√≥n, mientras que las conclusiones son las interpretaciones de esos resultados. Es importante no confundirlos: los resultados son datos objetivos, mientras que las conclusiones implican interpretaci√≥n y pueden ser m√°s subjetivas. Al leer un texto cient√≠fico, debemos evaluar si las conclusiones se derivan l√≥gicamente de los resultados presentados o si hay sobreinterpretaci√≥n de los datos."
                    },
                    "9-4": {
                        title: "Tablas y gr√°ficos",
                        description: "Las tablas y gr√°ficos son herramientas visuales para presentar datos de manera organizada y comprensible. Cada tipo tiene su funci√≥n: las tablas para datos precisos, los gr√°ficos de barras para comparar cantidades, los de l√≠neas para mostrar tendencias, los de dispersi√≥n para relaciones entre variables, etc. Interpretar correctamente estas representaciones visuales es fundamental para comprender los resultados de una investigaci√≥n."
                    },
                    "9-5": {
                        title: "Lenguaje t√©cnico",
                        description: "El lenguaje t√©cnico cient√≠fico utiliza terminolog√≠a espec√≠fica, precisa y a menudo universal en la comunidad cient√≠fica. Este lenguaje busca evitar ambig√ºedades y facilitar la comunicaci√≥n exacta de conceptos complejos. Para comprender textos cient√≠ficos, es necesario familiarizarse con este vocabulario o buscar definiciones de los t√©rminos desconocidos. Tambi√©n es importante reconocer que el lenguaje cient√≠fico suele ser cauteloso, usando expresiones como 'parece sugerir' o 'es probable que' en lugar de afirmaciones absolutas."
                    }
                }
            },
            10: {
                title: "Textos period√≠sticos",
                description: "Los textos period√≠sticos tienen como funci√≥n principal <span class='highlight'>informar sobre hechos de actualidad</span> de manera objetiva y veraz. Sin embargo, el periodismo actual incluye una variedad de g√©neros con diferentes prop√≥sitos, desde la noticia informativa hasta el art√≠culo de opini√≥n. Comprender las caracter√≠sticas de cada g√©nero nos permite interpretar correctamente la informaci√≥n, distinguir entre hechos y opiniones, y reconocer posibles sesgos o intenciones persuasivas.",
                subtopics: {
                    "10-1": {
                        title: "Noticia",
                        description: "La noticia es el relato de un hecho reciente, relevante y de inter√©s p√∫blico. Sigue una estructura conocida como pir√°mide invertida: lo m√°s importante al principio, seguido de detalles secundarios. Debe responder a las preguntas b√°sicas: qu√©, qui√©n, cu√°ndo, d√≥nde, c√≥mo y por qu√©. Una noticia bien escrita es objetiva, verificable y presenta diferentes perspectivas del hecho."
                    },
                    "10-2": {
                        title: "Reportaje",
                        description: "El reportaje es un g√©nero period√≠stico que profundiza en un tema o evento, proporcionando contexto, antecedentes y an√°lisis. A diferencia de la noticia, que se centra en el hecho inmediato, el reportaje explora las causas, consecuencias y m√∫ltiples facetas de un asunto. Combina informaci√≥n objetiva con elementos narrativos para hacer m√°s comprensible y atractivo el tema."
                    },
                    "10-3": {
                        title: "Editorial",
                        description: "El editorial es un art√≠culo de opini√≥n que representa la postura oficial del medio de comunicaci√≥n sobre un tema relevante. No va firmado por un autor espec√≠fico, sino que refleja la l√≠nea editorial del peri√≥dico o canal. Aunque se basa en hechos, su prop√≥sito es persuadir e influir en la opini√≥n p√∫blica, por lo que es importante distinguirlo de las noticias informativas."
                    },
                    "10-4": {
                        title: "Opini√≥n",
                        description: "Los art√≠culos de opini√≥n (o columnas) expresan el punto de vista personal de un autor sobre un tema. A diferencia del editorial, no representan la postura del medio, sino la del columnista. Estos textos combinan an√°lisis, argumentaci√≥n y reflexi√≥n personal, y son valiosos para entender diferentes perspectivas sobre un asunto, pero deben reconocerse como opiniones y no como hechos objetivos."
                    },
                    "10-5": {
                        title: "Publicidad",
                        description: "Aunque no es un g√©nero period√≠stico tradicional, la publicidad aparece frecuentemente en los medios y puede confundirse con contenido informativo. Su prop√≥sito es persuadir al consumidor para que compre un producto o servicio, utilizando recursos emocionales, est√©ticos y argumentativos. Es crucial distinguir la publicidad del contenido editorial para no ser influenciado por intereses comerciales al buscar informaci√≥n objetiva."
                    }
                }
            },
            11: {
                title: "An√°lisis intertextual",
                description: "El an√°lisis intertextual es la habilidad de <span class='highlight'>establecer relaciones entre diferentes textos</span> para enriquecer la comprensi√≥n. Todo texto est√° conectado con otros textos, ya sea expl√≠citamente (a trav√©s de citas, referencias) o impl√≠citamente (a trav√©s de temas, estructuras o estilos similares). Reconocer estas conexiones nos permite entender mejor el contexto cultural, literario o ideol√≥gico en que se produce un texto, y a apreciar c√≥mo los textos dialogan entre s√≠, construyendo y transformando significados colectivamente.",
                subtopics: {
                    "11-1": {
                        title: "Comparaci√≥n de textos",
                        description: "La comparaci√≥n de textos implica identificar semejanzas y diferencias entre dos o m√°s textos en cuanto a tema, estilo, estructura, prop√≥sito, etc. Esta comparaci√≥n puede revelar c√≥mo diferentes autores abordan un mismo problema desde perspectivas distintas, o c√≥mo evoluciona un tema a lo largo del tiempo. Por ejemplo, comparar dos art√≠culos sobre cambio clim√°tico de diferentes d√©cadas puede mostrar c√≥mo ha evolucionado la comprensi√≥n cient√≠fica y la preocupaci√≥n social sobre este tema."
                    },
                    "11-2": {
                        title: "Contraste de ideas",
                        description: "El contraste de ideas se centra en identificar oposiciones o tensiones entre textos. Esto puede incluir debates expl√≠citos (un texto que responde a otro) o contradicciones impl√≠citas. El contraste nos ayuda a entender la complejidad de un tema al considerar m√∫ltiples perspectivas. Por ejemplo, contrastar un texto que defiende la globalizaci√≥n con otro que la critica nos proporciona una visi√≥n m√°s equilibrada del fen√≥meno."
                    },
                    "11-3": {
                        title: "Coincidencias tem√°ticas",
                        description: "Identificar coincidencias tem√°ticas implica reconocer c√≥mo un mismo tema es tratado en diferentes textos, g√©neros o √©pocas. Estas coincidencias pueden revelar preocupaciones universales o valores culturales persistentes. Por ejemplo, el tema de la justicia aparece tanto en textos filos√≥ficos antiguos como en novelas contempor√°neas, y analizar c√≥mo se aborda en cada caso nos enriquece la comprensi√≥n del concepto."
                    },
                    "11-4": {
                        title: "Relaci√≥n de fuentes",
                        description: "La relaci√≥n de fuentes se refiere a c√≥mo un texto utiliza o se relaciona con otros textos como fuentes de informaci√≥n, inspiraci√≥n o di√°logo. Esto incluye citas directas, par√°frasis, alusiones o referencias impl√≠citas. Analizar estas relaciones nos permite entender el contexto intelectual en que se produce un texto y c√≥mo se posiciona respecto a otras voces en el debate sobre un tema."
                    },
                    "11-5": {
                        title: "Referencias culturales",
                        description: "Las referencias culturales son alusiones a elementos de la cultura popular, literatura, historia, arte, etc., que enriquecen el significado de un texto. Reconocer estas referencias nos permite entender capas adicionales de significado que podr√≠an pasar desapercibidas. Por ejemplo, un texto pol√≠tico que alude a una novela dist√≥pica puede estar utilizando esa referencia cultural para advertir sobre peligros actuales."
                    }
                }
            }
        };

        // Funci√≥n para mostrar notificaci√≥n
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Funci√≥n para actualizar la barra de progreso
        function updateProgressBar() {
            const totalModules = 11;
            const totalSubtopics = 55; // 5 subtemas por tema
            const progress = getUserProgress();
            const completedModules = progress.completedModules.length;
            const completedSubtopics = progress.completedSubtopics.length;
            
            // Calcular progreso combinado
            const moduleProgress = (completedModules / totalModules) * 50; // 50% del progreso viene de m√≥dulos
            const subtopicProgress = (completedSubtopics / totalSubtopics) * 50; // 50% viene de subtemas
            
            const totalProgress = moduleProgress + subtopicProgress;
            document.getElementById('progress-fill').style.width = `${totalProgress}%`;
        }

        // Funci√≥n para verificar si un m√≥dulo est√° desbloqueado
        function isModuleUnlocked(moduleId) {
            if (moduleId === 1) return true;
            
            const progress = getUserProgress();
            
            // Verificar si el m√≥dulo anterior est√° completado
            const previousModuleId = moduleId - 1;
            
            // Si es un m√≥dulo de examen (4, 7, 10), verificar que el examen anterior est√© aprobado
            if (moduleId === 4) {
                return progress.examScores.exam1 !== null && progress.examScores.exam1 >= 180;
            } else if (moduleId === 7) {
                return progress.examScores.exam2 !== null && progress.examScores.exam2 >= 180;
            } else if (moduleId === 10) {
                return progress.examScores.exam3 !== null && progress.examScores.exam3 >= 180;
            }
            
            // Para m√≥dulos normales, verificar que el anterior est√© completado
            return progress.completedModules.includes(previousModuleId);
        }

        // Funci√≥n para verificar si un subtema est√° desbloqueado
        function isSubtopicUnlocked(moduleId, subtopicId) {
            // Verificar que el m√≥dulo est√© desbloqueado
            if (!isModuleUnlocked(moduleId)) return false;
            
            const progress = getUserProgress();
            
            // Verificar que el tema principal haya sido visto
            if (!progress.completedModules.includes(moduleId)) return false;
            
            // Verificar que los subtemas anteriores est√©n completados
            const subtopicNumber = parseInt(subtopicId.split('-')[1]);
            if (subtopicNumber > 1) {
                const previousSubtopicId = `${moduleId}-${subtopicNumber - 1}`;
                if (!progress.completedSubtopics.includes(previousSubtopicId)) return false;
            }
            
            return true;
        }

        // Funci√≥n para actualizar el estado de los m√≥dulos y subtemas
        function updateModuleStates() {
            const progress = getUserProgress();
            
            // Actualizar m√≥dulos
            for (let i = 1; i <= 11; i++) {
                const moduleNode = document.querySelector(`.topic-node[data-id="${i}"]`);
                if (moduleNode) {
                    if (isModuleUnlocked(i)) {
                        moduleNode.classList.remove('locked');
                    } else {
                        moduleNode.classList.add('locked');
                    }
                }
            }
            
            // Actualizar subtemas
            document.querySelectorAll('.subtopic-node').forEach(subtopicNode => {
                const subtopicId = subtopicNode.getAttribute('data-id');
                const moduleId = parseInt(subtopicId.split('-')[0]);
                
                if (isSubtopicUnlocked(moduleId, subtopicId)) {
                    subtopicNode.classList.remove('locked');
                } else {
                    subtopicNode.classList.add('locked');
                }
            });
            
            // Actualizar ex√°menes
            const exam1Node = document.querySelector('.exam-node[data-id="exam1"]');
            const exam2Node = document.querySelector('.exam-node[data-id="exam2"]');
            const exam3Node = document.querySelector('.exam-node[data-id="exam3"]');
            const finalExamNode = document.querySelector('.exam-node[data-id="final-exam"]');
            
            if (progress.completedModules.includes(3)) {
                exam1Node.classList.remove('locked');
            } else {
                exam1Node.classList.add('locked');
            }
            
            if (progress.completedModules.includes(6)) {
                exam2Node.classList.remove('locked');
            } else {
                exam2Node.classList.add('locked');
            }
            
            if (progress.completedModules.includes(9)) {
                exam3Node.classList.remove('locked');
            } else {
                exam3Node.classList.add('locked');
            }
            
            if (progress.completedModules.includes(11)) {
                finalExamNode.classList.remove('locked');
            } else {
                finalExamNode.classList.add('locked');
            }
        }

        // Funci√≥n para mostrar el modal con el contenido del tema
        function showTopicModal(moduleId) {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalDescription = document.getElementById('modal-description');
            const modalSubtopics = document.getElementById('modal-subtopics');
            const gameBtn = document.getElementById('game-btn');
            const continueBtn = document.getElementById('continue-btn');
            
            const topic = topicsContent[moduleId];
            modalTitle.textContent = topic.title;
            modalDescription.innerHTML = topic.description;
            
            // Limpiar subtemas anteriores
            modalSubtopics.innerHTML = '';
            
            // Agregar subtemas
            Object.keys(topic.subtopics).forEach(subtopicId => {
                const subtopic = topic.subtopics[subtopicId];
                const subtopicDiv = document.createElement('div');
                subtopicDiv.className = 'modal-subtopic';
                subtopicDiv.innerHTML = `
                    <h4>${subtopic.title}</h4>
                    <p>${subtopic.description}</p>
                    <button class="btn subtopic-quiz-btn" data-subtopic="${subtopicId}">Cuestionario</button>
                `;
                modalSubtopics.appendChild(subtopicDiv);
            });
            
            // Configurar botones
            gameBtn.onclick = () => {
                // Redirigir al juego del tema
                window.location.href = `juego_tema_${moduleId}.html`;
            };
            
            continueBtn.onclick = () => {
                // Marcar el tema como completado
                const progress = getUserProgress();
                if (!progress.completedModules.includes(moduleId)) {
                    progress.completedModules.push(moduleId);
                    saveUserProgress(progress);
                    updateProgressBar();
                    updateModuleStates();
                    showNotification(`¬°Has completado el tema ${topic.title}!`);
                }
                modal.style.display = 'none';
            };
            
            // Configurar botones de cuestionario de subtemas
            document.querySelectorAll('.subtopic-quiz-btn').forEach(btn => {
                btn.onclick = (e) => {
                    e.stopPropagation();
                    const subtopicId = btn.getAttribute('data-subtopic');
                    // Redirigir al cuestionario del subtema
                    window.location.href = `cuestionario_${subtopicId}.html`;
                };
            });
            
            modal.style.display = 'block';
        }

        // Funci√≥n para mostrar el modal con el contenido del subtema
        function showSubtopicModal(moduleId, subtopicId) {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalDescription = document.getElementById('modal-description');
            const modalSubtopics = document.getElementById('modal-subtopics');
            const gameBtn = document.getElementById('game-btn');
            const continueBtn = document.getElementById('continue-btn');
            
            const topic = topicsContent[moduleId];
            const subtopic = topic.subtopics[subtopicId];
            
            modalTitle.textContent = subtopic.title;
            modalDescription.innerHTML = subtopic.description;
            modalSubtopics.innerHTML = '';
            
            gameBtn.style.display = 'none';
            continueBtn.textContent = 'Ir al cuestionario';
            continueBtn.onclick = () => {
                // Redirigir al cuestionario del subtema
                window.location.href = `cuestionario_${subtopicId}.html`;
            };
            
            modal.style.display = 'block';
        }

        // Funci√≥n para simular examen
        function simulateExam(examId) {
            const progress = getUserProgress();
            
            // Simular resultado del examen
            const score = Math.floor(Math.random() * 150) + 150; // Entre 150 y 300
            
            if (examId === 'exam1') {
                progress.examScores.exam1 = score;
            } else if (examId === 'exam2') {
                progress.examScores.exam2 = score;
            } else if (examId === 'exam3') {
                progress.examScores.exam3 = score;
            } else if (examId === 'final-exam') {
                progress.examScores.finalExam = score;
            }
            
            saveUserProgress(progress);
            
            if (score >= 180) {
                showNotification(`¬°Felicidades! Has aprobado el examen con ${score} puntos.`);
                updateModuleStates();
            } else {
                showNotification(`No has alcanzado la puntuaci√≥n m√≠nima. Tu puntuaci√≥n: ${score}/300. Int√©ntalo de nuevo.`);
            }
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            updateModuleStates();
            updateProgressBar();
            
            // Event listeners para m√≥dulos
            document.querySelectorAll('.topic-node').forEach(topicNode => {
                topicNode.addEventListener('click', () => {
                    const moduleId = parseInt(topicNode.getAttribute('data-id'));
                    if (isModuleUnlocked(moduleId)) {
                        showTopicModal(moduleId);
                    } else {
                        showNotification('Debes completar los niveles anteriores para desbloquear este m√≥dulo.');
                    }
                });
            });
            
            // Event listeners para subtemas
            document.querySelectorAll('.subtopic-node').forEach(subtopicNode => {
                subtopicNode.addEventListener('click', () => {
                    const subtopicId = subtopicNode.getAttribute('data-id');
                    const moduleId = parseInt(subtopicId.split('-')[0]);
                    
                    if (isSubtopicUnlocked(moduleId, subtopicId)) {
                        showSubtopicModal(moduleId, subtopicId);
                    } else {
                        showNotification('Debes completar los niveles anteriores para desbloquear este subtema.');
                    }
                });
            });
            
            // Event listeners para ex√°menes
            document.querySelectorAll('.exam-node').forEach(examNode => {
                examNode.addEventListener('click', () => {
                    const examId = examNode.getAttribute('data-id');
                    
                    if (!examNode.classList.contains('locked')) {
                        simulateExam(examId);
                    } else {
                        showNotification('Debes completar los niveles anteriores para desbloquear este examen.');
                    }
                });
            });
            
            // Cerrar modal
            document.getElementById('close-modal').addEventListener('click', () => {
                document.getElementById('modal').style.display = 'none';
            });
            
            // Cerrar modal al hacer clic fuera del contenido
            window.addEventListener('click', (e) => {
                const modal = document.getElementById('modal');
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        /*************************************************************************
         *  SISTEMA DE MISIONES Y PROGRESO (TOMADO DE MODULOS.HTML)
         *************************************************************************/

        // Initialize missions in localStorage if not present (keep any existing)
        function initMissions() {
            const stored = localStorage.getItem(MISSIONS_KEY);
            if (!stored) {
                const initial = missionsTemplate.map(m => ({ ...m, completed: false }));
                localStorage.setItem(MISSIONS_KEY, JSON.stringify(initial));
            }
        }

        // Render missions into panel - solo muestra las primeras 3 no completadas
        function renderMissions() {
            const data = JSON.parse(localStorage.getItem(MISSIONS_KEY) || "[]");
            const container = document.getElementById('misiones-content');
            container.innerHTML = '';
            
            // Filtrar solo las misiones no completadas y tomar las primeras 3
            const incompleteMissions = data.filter(m => !m.completed).slice(0, 3);
            
            if (incompleteMissions.length === 0) {
                container.innerHTML = '<div class="info">¬°Felicidades! Has completado todas las misiones disponibles.</div>';
                return;
            }
            
            incompleteMissions.forEach(m => {
                const div = document.createElement('div');
                div.className = 'mission-row';
                div.innerHTML = `
                    <div style="flex:1">
                        <div style="font-weight:700; color:var(--color-oliva-oscuro)">${m.id}. ${m.title}</div>
                        <div style="font-size:1rem; color:#556b2f">${m.points} ‚≠ê</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Sistema de notificaciones de misiones - muestra una por una
        let missionNotificationQueue = [];
        let isShowingNotification = false;

        function queueMissionNotification(mission) {
            missionNotificationQueue.push(mission);
            if (!isShowingNotification) {
                processMissionQueue();
            }
        }

        function processMissionQueue() {
            if (missionNotificationQueue.length === 0) {
                isShowingNotification = false;
                return;
            }
            
            isShowingNotification = true;
            const mission = missionNotificationQueue.shift();
            showMissionToast(`¬°Nueva misi√≥n disponible: ${mission.title} (+${mission.points}‚≠ê)!`, 60000);
            
            setTimeout(() => {
                processMissionQueue();
            }, 61000); // Espera un poco m√°s de 60 segundos para asegurar que la notificaci√≥n anterior se haya cerrado
        }

        // Inicializar notificaciones de misiones al cargar la p√°gina
        function initMissionNotifications() {
            const data = JSON.parse(localStorage.getItem(MISSIONS_KEY) || "[]");
            const incompleteMissions = data.filter(m => !m.completed).slice(0, 3);
            
            // Agregar las primeras 3 misiones no completadas a la cola de notificaciones
            incompleteMissions.forEach(mission => {
                queueMissionNotification(mission);
            });
        }

        // Toast show/hide
        let toastTimer = null;
        function showMissionToast(text, ms = 60000) {
            const toast = document.getElementById('mission-toast');
            toast.innerHTML = `<strong>${text}</strong> <div style="font-size:0.9rem;margin-top:6px;color:#666">Se ocultar√° en ${Math.ceil(ms/1000)}s</div>`;
            toast.classList.add('show');
            // countdown update (optional)
            let remaining = ms;
            if (toastTimer) clearInterval(toastTimer);
            toastTimer = setInterval(() => {
                remaining -= 1000;
                if (remaining <= 0) {
                    toast.classList.remove('show');
                    clearInterval(toastTimer);
                } else {
                    toast.innerHTML = `<strong>${text}</strong> <div style="font-size:0.9rem;margin-top:6px;color:#666">Se ocultar√° en ${Math.ceil(remaining/1000)}s</div>`;
                }
            }, 1000);
            // ensure hide after ms
            setTimeout(()=> {
                toast.classList.remove('show');
                if (toastTimer) { clearInterval(toastTimer); toastTimer = null; }
            }, ms + 200);
        }

        // Compute total points from completed missions
        function getTotalPoints() {
            const data = JSON.parse(localStorage.getItem(MISSIONS_KEY) || "[]");
            return data.reduce((sum, m) => sum + (m.completed ? m.points : 0), 0);
        }

        // Determine current level based on total points using LEVELS
        function getLevelFromPoints(total) {
            for (let i = LEVELS.length -1; i >=0; i--) {
                if (total >= LEVELS[i].min) return LEVELS[i];
            }
            return LEVELS[0];
        }

        // Render level panel content
        function renderLevel() {
            const total = getTotalPoints();
            const level = getLevelFromPoints(total);
            // compute progress to next level
            let nextMin = level.max === Infinity ? level.min : level.max + 1;
            let neededForNext = (level.max === Infinity) ? 0 : (level.max - total + 1);
            let progressPct = 0;
            if (level.max === Infinity) progressPct = 100;
            else progressPct = Math.min(100, Math.round(((total - level.min) / (level.max - level.min)) * 100));
            document.getElementById('nivel-content').innerHTML = `
                <div class="info"><strong>Nivel:</strong> ${level.name} (${level.idx})</div>
                <div class="info"><strong>Puntos acumulados:</strong> ${total} ‚≠ê</div>
                <div class="info"><strong>Progreso hacia siguiente nivel:</strong> ${progressPct}%</div>
                <div style="background:#f1f1f1;border-radius:10px;padding:8px;margin-top:10px">
                    <div style="height:12px;background:linear-gradient(90deg,var(--color-oliva-medio),#bdbd74);width:${progressPct}%;border-radius:8px"></div>
                </div>
                ${level.max === Infinity ? '<div class="info" style="margin-top:8px">¬°Has alcanzado el nivel m√°ximo!</div>' : `<div class="info" style="margin-top:8px">Puntos para subir: ${neededForNext} ‚≠ê</div>`}
            `;
        }

        // Render progress panel: percent toward top target (9500 = Rey/Reina)
        function renderProgress() {
            const total = getTotalPoints();
            const topTarget = 9500; // based on level thresholds
            const pct = Math.min(100, Math.round((total / topTarget) * 100));
            document.getElementById('progreso-content').innerHTML = `
                <div class="info"><strong>Puntos acumulados:</strong> ${total} ‚≠ê</div>
                <div class="info"><strong>Progreso global hacia Rey/Reina:</strong> ${pct}%</div>
                <div style="background:#f1f1f1;border-radius:10px;padding:8px;margin-top:10px">
                    <div style="height:12px;background:linear-gradient(90deg,var(--color-oliva-medio),#bdbd74);width:${pct}%;border-radius:8px"></div>
                </div>
                <div class="info" style="margin-top:10px"><strong>Misiones completadas:</strong> ${getCompletedCount()}/100</div>
            `;
        }

        function getCompletedCount() {
            const data = JSON.parse(localStorage.getItem(MISSIONS_KEY) || "[]");
            return data.filter(m => m.completed).length;
        }

        /*************************************************************************
         *  SISTEMA DE EX√ÅMENES BASADO EN TAGS
         *************************************************************************/

        // Ahora la funci√≥n guarda el puntaje de un examen espec√≠fico usando su tag √∫nico.
        // examTag: Un string √∫nico, ej: 'RC-razonamiento-logico' o 'diagnostico'
        // score: 0 - 300
        function addExamScore(examTag, score) {
            if (!examTag || typeof score !== 'number' || score < 0 || score > 300) {
                console.error("Puntaje de examen inv√°lido.", { examTag, score });
                return false;
            }

            // Obtenemos el objeto de puntajes actual (si no hay, usamos uno vac√≠o)
            let examScores = JSON.parse(localStorage.getItem(EXAMS_KEY) || '{}');

            // Actualizamos SOLO el puntaje del examen con el tag correspondiente.
            // Si el examen se repite, este valor se sobrescribe.
            examScores[examTag] = score;

            // Guardamos el objeto actualizado
            localStorage.setItem(EXAMS_KEY, JSON.stringify(examScores));
            console.log(`Puntaje para el examen '${examTag}' actualizado a ${score}.`);
            return true;
        }

        // Calcula el promedio de TODOS los ex√°menes, excepto 'diagnostico'.
        function getExamStats() {
            const examScores = JSON.parse(localStorage.getItem(EXAMS_KEY) || '{}');
            
            // Filtramos para excluir el examen de diagn√≥stico del promedio
            const { diagnostico, ...otherExams } = examScores;
            const scores = Object.values(otherExams); // Obtenemos una lista de los puntajes de los ex√°menes normales

            if (scores.length === 0) {
                return { 
                    count: 0, 
                    sum: 0, 
                    avg: 0, 
                    details: otherExams,
                    diagnosticScore: diagnostico || 'N/A' // Mostramos el puntaje del diagn√≥stico por separado
                };
            }

            const sum = scores.reduce((a, b) => a + b, 0);
            const avg = Math.round(sum / scores.length);

            return {
                count: scores.length, // N√∫mero de ex√°menes (sin contar diagn√≥stico)
                sum: sum,
                avg: avg,
                details: otherExams, // Puntajes de todos los ex√°menes excepto diagn√≥stico
                diagnosticScore: diagnostico || 'N/A' // Puntaje del diagn√≥stico
            };
        }

        function renderAnalysis() {
            const stats = getExamStats();
            
            // Mostramos el puntaje del diagn√≥stico de forma destacada
            let diagnosticHtml = `<div class="info"><strong>Puntaje Inicial (Diagn√≥stico):</strong> ${stats.diagnosticScore} / 300</div>`;
            
            let detailsHtml = '';
            // Mostramos los detalles de los ex√°menes normales
            for (const tag in stats.details) {
                detailsHtml += `<div class="info" style="font-size:1rem; color:#555;">- ${tag}: ${stats.details[tag]} / 300</div>`;
            }

            document.getElementById('analisis-stats').innerHTML = `
                ${diagnosticHtml}
                <hr style="margin: 12px 0; border: none; border-top: 1px solid #eee;">
                <div class="info"><strong>Ex√°menes de pr√°ctica realizados:</strong> ${stats.count}</div>
                <div class="info"><strong>Suma de puntajes (pr√°ctica):</strong> ${stats.sum}</div>
                <div class="info"><strong>Promedio general (pr√°ctica):</strong> ${stats.avg} / 300</div>
                <hr style="margin: 12px 0; border: none; border-top: 1px solid #eee;">
                <div style="font-weight: bold; margin-bottom: 8px;">√öltimos Puntajes por Examen:</div>
                ${detailsHtml || '<div class="info" style="color:#888;">A√∫n no hay ex√°menes de pr√°ctica registrados.</div>'}
                <div style="margin-top:10px;">
                    <button id="clear-exams" style="background:var(--float-color); color:white; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; font-size:1rem;">Borrar todos los puntajes</button>
                </div>
            `;
            document.getElementById('clear-exams').addEventListener('click', () => {
                if (confirm('¬øEliminar todos los puntajes de ex√°menes registrados?')) {
                    localStorage.removeItem(EXAMS_KEY);
                    renderAnalysis();
                }
            });
        }

        // Ahora las misiones se verifican con el puntaje del examen espec√≠fico.
        function checkExamMissions(examTag, score) {
            const data = JSON.parse(localStorage.getItem(MISSIONS_KEY) || "[]");
            let changed = false;

            // Misi√≥n 1: "Completa tu primer examen" (que no sea de diagn√≥stico)
            if (examTag !== 'diagnostico' && score > 0) {
                const m1 = data.find(m => m.id === 1);
                if (m1 && !m1.completed) {
                    completeMission(1);
                    changed = true;
                }
            }
            // Misi√≥n 2: "Logra al menos 180/300 en un examen"
            if (score >= 180) {
                const m2 = data.find(m => m.id === 2);
                if (m2 && !m2.completed) {
                    completeMission(2);
                    changed = true;
                }
            }
            // Misi√≥n 11: "Logra 240/300 en un examen"
            if (score >= 240) {
                const m11 = data.find(m => m.id === 11);
                if (m11 && !m11.completed) {
                    completeMission(11);
                    changed = true;
                }
            }
            // Misi√≥n 12: "Completa un examen sin errores (300/300)"
            if (score === 300) {
                const m12 = data.find(m => m.id === 12);
                if (m12 && !m12.completed) {
                    completeMission(12);
                    changed = true;
                }
            }
            if (changed) updateAllDisplays();
        }

        // UI: open/close panels
        function closeAllPanels() {
            document.querySelectorAll('.panel-box').forEach(p => p.classList.remove('active'));
        }

        document.getElementById('btn-misiones').addEventListener('click', ()=> {
            togglePanelBox('panel-misiones');
        });
        document.getElementById('btn-nivel').addEventListener('click', ()=> {
            togglePanelBox('panel-nivel');
        });
        document.getElementById('btn-progreso').addEventListener('click', ()=> {
            togglePanelBox('panel-progreso');
        });
        document.getElementById('btn-analisis').addEventListener('click', ()=> {
            togglePanelBox('panel-analisis');
            renderAnalysis();
        });

        document.querySelectorAll('.close-panel').forEach(btn=>{
            btn.addEventListener('click', (e)=>{
                const parent = e.currentTarget.closest('.panel-box');
                if (parent) parent.classList.remove('active');
            });
        });

        function togglePanelBox(id) {
            const el = document.getElementById(id);
            if (!el) return;
            const isActive = el.classList.contains('active');
            closeAllPanels();
            if (!isActive) {
                el.classList.add('active');
                // render relevant content
                if (id === 'panel-misiones') renderMissions();
                if (id === 'panel-nivel') renderLevel();
                if (id === 'panel-progreso') renderProgress();
                if (id === 'panel-analisis') renderAnalysis();
            }
        }

        // Funci√≥n para marcar autom√°ticamente una misi√≥n como completada
        function completeMission(id) {
            const data = JSON.parse(localStorage.getItem(MISSIONS_KEY) || "[]");
            const idx = data.findIndex(m => m.id === id);
            if (idx === -1) return;
            const mission = data[idx];
            if (!mission.completed) {
                mission.completed = true;
                localStorage.setItem(MISSIONS_KEY, JSON.stringify(data));
                showMissionToast(`¬°Misi√≥n completada: ${mission.title} (+${mission.points}‚≠ê)!`, 60000);
                updateAllDisplays();
                
                // Verificar si hay nuevas misiones para mostrar
                const incompleteMissions = data.filter(m => !m.completed).slice(0, 3);
                if (incompleteMissions.length > 0) {
                    queueMissionNotification(incompleteMissions[0]);
                }
            }
        }

        // update all displayed panels' content
        function updateAllDisplays() {
            if (document.getElementById('panel-misiones').classList.contains('active')) renderMissions();
            if (document.getElementById('panel-nivel').classList.contains('active')) renderLevel();
            if (document.getElementById('panel-progreso').classList.contains('active')) renderProgress();
            if (document.getElementById('panel-analisis').classList.contains('active')) renderAnalysis();
        }

        // initial setup
        (function init() {
            initMissions();
            // attach click outside to close panels
            document.addEventListener('click', (e)=>{
                const panels = document.querySelectorAll('.panel-box');
                const isIcon = e.target.closest('.floating-icons');
                const isPanel = e.target.closest('.panel-box');
                if (!isIcon && !isPanel) {
                    panels.forEach(p => p.classList.remove('active'));
                }
            });
            // show mission count badge on icon? (optional)
            renderMissions(); // prepare data
            renderLevel();
            renderProgress();
            renderAnalysis();
            
            // Inicializar sistema de notificaciones de misiones
            initMissionNotifications();
        })();

        // expose functions for other pages to push exam scores or mark missions programmatically:
        window.SKOPIA = {
            addExamScore, // Ahora requiere (examTag, score)
            completeMission,
            getTotalPoints: getTotalPoints,
            getLevel: ()=> getLevelFromPoints(getTotalPoints())
        };

        // ORIGINAL SCRIPTS (kept unchanged)
        document.addEventListener('DOMContentLoaded', () => {
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const userDropdown = document.getElementById('user-dropdown');
            hamburgerMenu.addEventListener('click', () => {
                userDropdown.classList.toggle('active');
            });
            window.addEventListener('click', (event) => {
                if (!event.target.closest('.navbar')) {
                    userDropdown.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
